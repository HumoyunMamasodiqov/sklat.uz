<!DOCTYPE html>
<html lang="uz">
    {% load static %}
<head>
    <script src="https://static.readdy.ai/static/e.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sklat.uz | Mahsulotlar</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="{% static 'img/sklatlogo.png' %}">
    <link rel="apple-touch-icon" sizes="512x512" href="{% static 'img/sklatlogo.png' %}">
    <link rel="manifest" href="{% static 'manifest.json' %}">
    
    <!-- CSS va JavaScript kutubxonalari -->
    <script src="https://cdn.tailwindcss.com/3.4.16"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B82F6',
                        secondary: '#10B981'
                    },
                    borderRadius: {
                        'none': '0px',
                        'sm': '4px',
                        DEFAULT: '8px',
                        'md': '12px',
                        'lg': '16px',
                        'xl': '20px',
                        '2xl': '24px',
                        '3xl': '32px',
                        'full': '9999px',
                        'button': '8px'
                    }
                }
            }
        }
    </script>
    
    <!-- Fontlar va ikonlar -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css">
    
    <style>
        :where([class^="ri-"])::before { content: "\f3c2"; }
        
        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        
        input[type="number"] {
            -moz-appearance: textfield;
        }
        
        /* Animatsiyalar */
        .slide-in {
            animation: slideIn 0.3s ease-out;
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-out;
        }
        
        @keyframes slideIn {
            from {
                transform: translateY(100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        
        /* Low stock warning */
        .low-stock {
            background-color: #FEF2F2;
            border-left: 4px solid #EF4444;
        }
        
        .out-of-stock {
            background-color: #FFFBEB;
            border-left: 4px solid #F59E0B;
        }
        
        /* Table view style */
        .table-view .category-header {
            display: none;
        }
        
        .table-view .category-products {
            display: block;
        }
        
        .table-view .product-item {
            display: flex;
            align-items: center;
            padding: 12px;
        }
    </style>
</head>

<body class="bg-gray-50">
    <!-- Header -->
    <header class="fixed top-0 w-full bg-white shadow-sm z-50">
        <div class="flex items-center justify-between px-4 py-3">
            <div class="flex items-center space-x-3">
                <a href="{% url 'home' %}" class="w-8 h-8 bg-gray-100 rounded-lg flex items-center justify-center cursor-pointer">
                    <i class="ri-arrow-left-line text-gray-600"></i>
                </a>
                <h1 class="text-lg font-semibold text-gray-800">Mahsulotlar</h1>
            </div>
            <div class="flex items-center space-x-3">
                <button class="w-8 h-8 bg-gray-100 rounded-lg flex items-center justify-center cursor-pointer" id="view-toggle">
                    <i class="ri-layout-grid-line text-gray-600"></i>
                </button>
                <div class="relative">
                    <button class="w-8 h-8 bg-gray-100 rounded-lg flex items-center justify-center cursor-pointer" id="filter-menu-btn">
                        <i class="ri-more-2-line text-gray-600"></i>
                    </button>
                    <div class="absolute right-0 top-10 bg-white shadow-lg rounded-lg p-2 w-48 hidden" id="filter-menu">
                        <button class="w-full px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 rounded flex items-center space-x-2" id="sort-az">
                            <i class="ri-sort-alphabet-asc text-gray-400"></i>
                            <span>A-Z tartibi</span>
                        </button>
                        <button class="w-full px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 rounded flex items-center space-x-2" id="sort-za">
                            <i class="ri-sort-alphabet-desc text-gray-400"></i>
                            <span>Z-A tartibi</span>
                        </button>
                        <hr class="my-1">
                        <button class="w-full px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 rounded flex items-center space-x-2" id="show-low-stock">
                            <i class="ri-error-warning-line text-red-400"></i>
                            <span>Kam qolganlar</span>
                        </button>
                        <button class="w-full px-3 py-2 text-sm text-gray-700 hover:bg-gray-50 rounded flex items-center space-x-2" id="show-out-of-stock">
                            <i class="ri-forbid-line text-orange-400"></i>
                            <span>Tugaganlar</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </header>
    
    <!-- Search and Filter Section -->
    <section class="pt-20 px-4 pb-4 bg-white">
        <form method="GET" action="{% url 'mahsulotlar' %}" class="mb-4">
            <div class="relative">
                <input type="text" name="q" value="{{ search_query }}" placeholder="Mahsulot nomi yoki shtrix kod bo'yicha qidirish..."
                    class="w-full pl-10 pr-12 py-3 bg-gray-50 rounded-lg text-sm border-none focus:ring-2 focus:ring-primary focus:outline-none" id="search-input">
                <div class="absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 flex items-center justify-center">
                    <i class="ri-search-line text-gray-400 text-sm"></i>
                </div>
                <button type="submit" class="absolute right-3 top-1/2 transform -translate-y-1/2 w-6 h-6 bg-primary rounded flex items-center justify-center cursor-pointer !rounded-button">
                    <i class="ri-search-line text-white text-xs"></i>
                </button>
            </div>
        </form>
        
        <div class="flex space-x-2 overflow-x-auto pb-2" id="category-filters">
            <a href="?category=all{% if search_query %}&q={{ search_query }}{% endif %}" 
               class="px-4 py-2 {% if current_category == 'all' or not current_category %}bg-primary text-white{% else %}bg-gray-100 text-gray-600{% endif %} rounded-full text-sm whitespace-nowrap cursor-pointer !rounded-button">
                Barchasi
            </a>
          
        </div>
    </section>
    
    <!-- Action Buttons -->
    <section class="px-4 pb-4">
        <div class="flex space-x-3">
            <a href="{% url 'add_product' %}" class="flex-1 bg-primary text-white py-3 px-4 rounded-lg text-sm font-medium cursor-pointer !rounded-button flex items-center justify-center space-x-2" id="add-product-btn">
                <i class="ri-add-line"></i>
                <span>Mahsulot qo'shish</span>
            </a>
            <button class="bg-white border border-gray-200 text-gray-700 py-3 px-4 rounded-lg text-sm font-medium cursor-pointer !rounded-button flex items-center justify-center space-x-2" onclick="alert('Tez orada ishga tushadi!')">
                <i class="ri-download-line"></i>
                <span>Import</span>
            </button>
            <button class="bg-white border border-gray-200 text-gray-700 py-3 px-4 rounded-lg text-sm font-medium cursor-pointer !rounded-button flex items-center justify-center space-x-2" onclick="alert('Tez orada ishga tushadi!')">
                <i class="ri-upload-line"></i>
                <span>Export</span>
            </button>
        </div>
    </section>
    
    <!-- Stats Cards -->
    <section class="px-4 pb-4">
        <div class="grid grid-cols-3 gap-3">
            <div class="bg-white rounded-xl p-3 shadow-sm">
                <div class="flex items-center justify-between mb-2">
                    <div class="w-6 h-6 bg-blue-100 rounded-lg flex items-center justify-center">
                        <i class="ri-shopping-bag-3-line text-blue-600 text-sm"></i>
                    </div>
                </div>
                <div class="text-lg font-semibold text-gray-800">{{ total_products }}</div>
                <div class="text-xs text-gray-500">Jami mahsulot</div>
            </div>
            <div class="bg-white rounded-xl p-3 shadow-sm">
                <div class="flex items-center justify-between mb-2">
                    <div class="w-6 h-6 bg-red-100 rounded-lg flex items-center justify-center">
                        <i class="ri-error-warning-line text-red-600 text-sm"></i>
                    </div>
                </div>
                <div class="text-lg font-semibold text-gray-800">{{ low_stock_count }}</div>
                <div class="text-xs text-gray-500">Kam qolgan</div>
            </div>
            <div class="bg-white rounded-xl p-3 shadow-sm">
                <div class="flex items-center justify-between mb-2">
                    <div class="w-6 h-6 bg-purple-100 rounded-lg flex items-center justify-center">
                        <i class="ri-folder-3-line text-purple-600 text-sm"></i>
                    </div>
                </div>
                <div class="text-lg font-semibold text-gray-800">{{ total_categories }}</div>
                <div class="text-xs text-gray-500">Kategoriya</div>
            </div>
        </div>
    </section>
    
    <!-- Sort and Filter Options -->
    <section class="px-4 pb-4">
        <div class="flex items-center justify-between mb-4">
            <div class="flex items-center space-x-3">
                <button class="flex items-center space-x-2 text-sm text-gray-600 cursor-pointer" id="sort-btn">
                    <i class="ri-sort-asc text-gray-400"></i>
                    <span>Saralash</span>
                </button>
                <button class="flex items-center space-x-2 text-sm text-gray-600 cursor-pointer" id="filter-btn">
                    <i class="ri-filter-3-line text-gray-400"></i>
                    <span>Filtr</span>
                </button>
            </div>
            <div class="flex items-center space-x-2">
                <span class="text-sm text-gray-500">{{ total_products }} ta mahsulot</span>
            </div>
        </div>
    </section>
    
    <!-- Products List -->
    <section class="px-4 pb-24" id="products-container">
        {% if category_products %}
            {% for category_name, category_data in category_products.items %}
                {% if category_data.products %}
                <div class="mb-6 category-section" data-category="{{ category_name|slugify }}">
                    <div class="flex items-center justify-between mb-3 cursor-pointer category-header">
                        <h3 class="text-base font-semibold text-gray-800">{{ category_name }}</h3>
                        <div class="flex items-center space-x-2">
                            <span class="text-xs text-gray-500">{{ category_data.count }} mahsulot</span>
                            <i class="ri-arrow-down-s-line text-gray-400 transform transition-transform"></i>
                        </div>
                    </div>
                    <div class="space-y-3 category-products">
                        {% for product in category_data.products %}
                        <div class="bg-white rounded-xl p-4 shadow-sm cursor-pointer product-item 
                            {% if product.is_low_stock %}low-stock{% endif %}
                            {% if product.quantity <= 0 %}out-of-stock{% endif %}"
                            data-category="{{ category_name|slugify }}" 
                            data-name="{{ product.name|lower }}"
                            data-sku="{{ product.sku|lower }}"
                            data-quantity="{{ product.quantity }}">
                            <div class="flex items-center space-x-3">
                                <div class="w-16 h-16 bg-gray-100 rounded-lg overflow-hidden">
                                    {% if product.image %}
                                    <img src="{{ product.image.url }}" alt="{{ product.name }}" class="w-full h-full object-cover object-top">
                                    {% else %}
                                    <div class="w-full h-full flex items-center justify-center bg-gray-200">
                                        <i class="ri-image-line text-gray-400 text-2xl"></i>
                                    </div>
                                    {% endif %}
                                </div>
                                <div class="flex-1">
                                    <div class="flex items-center justify-between mb-1">
                                        <h4 class="font-medium text-gray-800">{{ product.name }}</h4>
                                        <div class="flex items-center space-x-1">
                                            <a href="{% url 'edit_product' product.id %}" class="w-6 h-6 bg-gray-100 rounded flex items-center justify-center cursor-pointer edit-btn">
                                                <i class="ri-edit-line text-gray-600 text-xs"></i>
                                            </a>
                                            <button class="w-6 h-6 bg-red-100 rounded flex items-center justify-center cursor-pointer delete-btn" data-product-id="{{ product.id }}" data-product-name="{{ product.name }}">
                                                <i class="ri-delete-bin-line text-red-600 text-xs"></i>
                                            </button>
                                        </div>
                                    </div>
                                    <p class="text-xs text-gray-500 mb-2">
                                        {{ product.category.name }} â€¢ SKU: {{ product.sku }}
                                        {% if product.is_low_stock %}
                                        <span class="text-red-500 font-medium ml-2">
                                            <i class="ri-error-warning-line text-xs"></i> Kam qoldi!
                                        </span>
                                        {% endif %}
                                    </p>
                                    <div class="flex items-center justify-between">
                                        <div class="text-sm">
                                            <span class="text-gray-500">Kirim:</span>
                                            <span class="font-medium text-gray-800">{{ product.purchase_price|floatformat:0 }} so'm</span>
                                        </div>
                                        <div class="text-right">
                                            <div class="text-sm font-medium text-primary">{{ product.sale_price|floatformat:0 }} so'm</div>
                                            <div class="text-xs {% if product.quantity <= 0 %}text-orange-500{% elif product.is_low_stock %}text-red-500{% else %}text-gray-500{% endif %}">
                                                {% if product.quantity <= 0 %}
                                                    <i class="ri-forbid-line text-xs"></i>
                                                    <span class="font-medium">Tugagan</span>
                                                {% else %}
                                                    {{ product.quantity|floatformat:0 }} {{ product.get_unit_display }} mavjud
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
            {% endfor %}
        {% else %}
            <div class="text-center py-12">
                <div class="w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="ri-shopping-bag-3-line text-gray-400 text-3xl"></i>
                </div>
                <h3 class="text-lg font-semibold text-gray-800 mb-2">Mahsulotlar topilmadi</h3>
                <p class="text-gray-500 mb-6 max-w-xs mx-auto">
                    {% if search_query %}
                    "{{ search_query }}" so'zi bo'yicha mahsulot topilmadi
                    {% else %}
                    Hozircha mahsulotlar mavjud emas. Yangi mahsulot qo'shing
                    {% endif %}
                </p>
                <a href="{% url 'add_product' %}" class="inline-flex items-center space-x-2 bg-primary text-white py-3 px-6 rounded-lg font-medium cursor-pointer !rounded-button">
                    <i class="ri-add-line"></i>
                    <span>Mahsulot qo'shish</span>
                </a>
            </div>
        {% endif %}
    </section>
    
    <!-- FAB Button -->
    <a href="{% url 'add_product' %}">
        <button class="fixed bottom-20 right-4 w-14 h-14 bg-primary rounded-full shadow-lg flex items-center justify-center cursor-pointer !rounded-button z-40" id="fab-add-product">
            <i class="ri-add-fill text-white text-2xl"></i>
        </button>
    </a>
    
    <!-- Bottom Navigation -->
    <nav class="fixed bottom-0 w-full bg-white border-t border-gray-200 z-50">
        <div class="grid grid-cols-5 h-16">
            <a href="{% url 'home' %}" class="flex flex-col items-center justify-center space-y-1 cursor-pointer">
                <div class="w-6 h-6 flex items-center justify-center">
                    <i class="ri-home-5-line text-gray-400"></i>
                </div>
                <span class="text-xs text-gray-400">Bosh sahifa</span>
            </a>
            
            <button class="flex flex-col items-center justify-center space-y-1 cursor-pointer active-nav">
                <div class="w-6 h-6 flex items-center justify-center">
                    <i class="ri-shopping-bag-3-fill text-primary"></i>
                </div>
                <span class="text-xs text-primary font-medium">Mahsulotlar</span>
            </button>
            
            <a href="{% url 'analitika' %}" class="flex flex-col items-center justify-center space-y-1 cursor-pointer">
                <div class="w-6 h-6 flex items-center justify-center">
                    <i class="ri-bar-chart-box-line text-gray-400"></i>
                </div>
                <span class="text-xs text-gray-400">Analitika</span>
            </a>
            
            <a href="{% url 'mijozlar' %}" class="flex flex-col items-center justify-center space-y-1 cursor-pointer">
                <div class="w-6 h-6 flex items-center justify-center">
                    <i class="ri-group-line text-gray-400"></i>
                </div>
                <span class="text-xs text-gray-400">Mijozlar</span>
            </a>
            
            <a href="{% url 'sozlamalar' %}" class="flex flex-col items-center justify-center space-y-1 cursor-pointer">
                <div class="w-6 h-6 flex items-center justify-center">
                    <i class="ri-settings-3-line text-gray-400"></i>
                </div>
                <span class="text-xs text-gray-400">Sozlamalar</span>
            </a>
        </div>
    </nav>
    
    <!-- Delete Confirmation Modal Template -->
    <div id="delete-modal-template" class="hidden">
        <div class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
            <div class="bg-white rounded-2xl p-6 w-full max-w-sm slide-in">
                <div class="text-center mb-6">
                    <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="ri-delete-bin-line text-red-600 text-2xl"></i>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-800 mb-2">Mahsulotni o'chirish</h3>
                    <p id="delete-message" class="text-sm text-gray-600"></p>
                </div>
                <div class="flex space-x-3">
                    <button class="flex-1 bg-gray-100 text-gray-700 py-3 rounded-lg font-medium cursor-pointer !rounded-button cancel-delete">Bekor qilish</button>
                    <form method="POST" id="delete-form" class="flex-1">
                        {% csrf_token %}
                        <button type="submit" class="w-full bg-red-600 text-white py-3 rounded-lg font-medium cursor-pointer !rounded-button">O'chirish</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    
    <!-- JavaScript -->
    <script>
        // DOM yuklanganda
        document.addEventListener('DOMContentLoaded', function() {
            // Filter menyusi
            const filterMenuBtn = document.getElementById('filter-menu-btn');
            const filterMenu = document.getElementById('filter-menu');
            
            if (filterMenuBtn && filterMenu) {
                filterMenuBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    filterMenu.classList.toggle('hidden');
                });
                
                document.addEventListener('click', function(e) {
                    if (!filterMenuBtn.contains(e.target) && !filterMenu.contains(e.target)) {
                        filterMenu.classList.add('hidden');
                    }
                });
            }
            
            // Kategoriya toggling
            const categoryHeaders = document.querySelectorAll('.category-header');
            categoryHeaders.forEach(header => {
                header.addEventListener('click', function() {
                    const categoryProducts = this.nextElementSibling;
                    const arrow = this.querySelector('i');
                    
                    if (categoryProducts.style.maxHeight && categoryProducts.style.maxHeight !== '0px') {
                        categoryProducts.style.maxHeight = '0px';
                        categoryProducts.style.overflow = 'hidden';
                        arrow.style.transform = 'rotate(-90deg)';
                    } else {
                        categoryProducts.style.maxHeight = categoryProducts.scrollHeight + 'px';
                        categoryProducts.style.overflow = 'visible';
                        arrow.style.transform = 'rotate(0deg)';
                    }
                });
                
                // Dastlabki holatni o'rnatish
                const categoryProducts = header.nextElementSibling;
                categoryProducts.style.maxHeight = categoryProducts.scrollHeight + 'px';
                categoryProducts.style.transition = 'max-height 0.3s ease';
            });
            
            // Kategoriya filter qilish (client-side)
            const categoryFilterButtons = document.querySelectorAll('#category-filters a');
            categoryFilterButtons.forEach(button => {
                button.addEventListener('click', function(e) {
                    // Backend orqali filter qilish uchun a tegiga URL berilgan
                });
            });
            
            // Search funksiyasi (client-side)
            const searchInput = document.getElementById('search-input');
            const productItems = document.querySelectorAll('.product-item');
            const categorySections = document.querySelectorAll('.category-section');
            
            if (searchInput) {
                searchInput.addEventListener('input', function() {
                    const searchTerm = this.value.toLowerCase().trim();
                    
                    let visibleProductsCount = 0;
                    let visibleCategories = 0;
                    
                    categorySections.forEach(section => {
                        let hasVisibleProducts = false;
                        const productsInSection = section.querySelectorAll('.product-item');
                        
                        productsInSection.forEach(product => {
                            const productName = product.dataset.name.toLowerCase();
                            const productSKU = product.dataset.sku.toLowerCase();
                            
                            if (searchTerm === '' || productName.includes(searchTerm) || productSKU.includes(searchTerm)) {
                                product.style.display = 'flex';
                                hasVisibleProducts = true;
                                visibleProductsCount++;
                            } else {
                                product.style.display = 'none';
                            }
                        });
                        
                        if (hasVisibleProducts) {
                            section.style.display = 'block';
                            visibleCategories++;
                        } else {
                            section.style.display = 'none';
                        }
                    });
                    
                    // Agar hech qanday mahsulot topilmasa
                    const emptyState = document.querySelector('.text-center.py-12');
                    if (searchTerm && visibleProductsCount === 0) {
                        if (!emptyState) {
                            showEmptyState(searchTerm);
                        }
                    } else if (emptyState && searchTerm === '') {
                        emptyState.remove();
                    }
                });
                
                // Enter bosilganda backendga yuborish
                searchInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        this.form.submit();
                    }
                });
            }
            
            // Mahsulotni o'chirish
            const deleteButtons = document.querySelectorAll('.delete-btn');
            deleteButtons.forEach(button => {
                button.addEventListener('click', function(e) {
                    e.stopPropagation();
                    e.preventDefault();
                    
                    const productId = this.dataset.productId;
                    const productName = this.dataset.productName;
                    
                    showDeleteModal(productId, productName);
                });
            });
            
            // View toggle (grid/list)
            const viewToggle = document.getElementById('view-toggle');
            if (viewToggle) {
                viewToggle.addEventListener('click', function() {
                    const productsContainer = document.getElementById('products-container');
                    const icon = this.querySelector('i');
                    
                    if (productsContainer.classList.contains('table-view')) {
                        // Grid view
                        productsContainer.classList.remove('table-view');
                        icon.className = 'ri-layout-grid-line text-gray-600';
                        
                        // Kategoriya sarlavhalarini ko'rsatish
                        document.querySelectorAll('.category-header').forEach(header => {
                            header.style.display = 'flex';
                        });
                        
                        // Mahsulotlar normal ko'rinishda
                        document.querySelectorAll('.product-item').forEach(item => {
                            item.style.display = 'block';
                        });
                    } else {
                        // Table view
                        productsContainer.classList.add('table-view');
                        icon.className = 'ri-list-unordered text-gray-600';
                        
                        // Kategoriya sarlavhalarini yashirish
                        document.querySelectorAll('.category-header').forEach(header => {
                            header.style.display = 'none';
                        });
                        
                        // Mahsulotlar compact ko'rinishda
                        document.querySelectorAll('.product-item').forEach(item => {
                            item.style.display = 'flex';
                        });
                    }
                });
            }
            
            // Sort funksiyalari
            const sortAZ = document.getElementById('sort-az');
            const sortZA = document.getElementById('sort-za');
            const showLowStock = document.getElementById('show-low-stock');
            const showOutOfStock = document.getElementById('show-out-of-stock');
            
            if (sortAZ) {
                sortAZ.addEventListener('click', function() {
                    sortProducts('name', 'asc');
                    filterMenu.classList.add('hidden');
                });
            }
            
            if (sortZA) {
                sortZA.addEventListener('click', function() {
                    sortProducts('name', 'desc');
                    filterMenu.classList.add('hidden');
                });
            }
            
            if (showLowStock) {
                showLowStock.addEventListener('click', function() {
                    filterLowStockProducts();
                    filterMenu.classList.add('hidden');
                });
            }
            
            if (showOutOfStock) {
                showOutOfStock.addEventListener('click', function() {
                    filterOutOfStockProducts();
                    filterMenu.classList.add('hidden');
                });
            }
        });
        
        // Helper functions
        function showDeleteModal(productId, productName) {
            const template = document.getElementById('delete-modal-template');
            const modalHTML = template.innerHTML;
            
            const modalDiv = document.createElement('div');
            modalDiv.innerHTML = modalHTML;
            modalDiv.id = 'delete-modal';
            
            // Matnni o'rnatish
            const messageElement = modalDiv.querySelector('#delete-message');
            messageElement.textContent = `"${productName}" mahsulotini o'chirishga ishonchingiz komilmi?`;
            
            // Form action o'rnatish
            const form = modalDiv.querySelector('#delete-form');
            form.action = `/delete-product/${productId}/`;
            
            document.body.appendChild(modalDiv);
            
            // Event listenerlar
            const modal = modalDiv.querySelector('div');
            const cancelButton = modal.querySelector('.cancel-delete');
            
            cancelButton.addEventListener('click', function() {
                document.body.removeChild(modalDiv);
            });
            
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    document.body.removeChild(modalDiv);
                }
            });
        }
        
        function showEmptyState(searchTerm) {
            const productsContainer = document.getElementById('products-container');
            
            const emptyState = document.createElement('div');
            emptyState.className = 'text-center py-12 fade-in';
            emptyState.innerHTML = `
                <div class="w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="ri-search-line text-gray-400 text-3xl"></i>
                </div>
                <h3 class="text-lg font-semibold text-gray-800 mb-2">Mahsulot topilmadi</h3>
                <p class="text-gray-500 mb-6 max-w-xs mx-auto">
                    "${searchTerm}" so'zi bo'yicha mahsulot topilmadi
                </p>
                <button onclick="clearSearch()" class="inline-flex items-center space-x-2 bg-primary text-white py-3 px-6 rounded-lg font-medium cursor-pointer !rounded-button">
                    <i class="ri-close-line"></i>
                    <span>Qidiruvni tozalash</span>
                </button>
            `;
            
            productsContainer.innerHTML = '';
            productsContainer.appendChild(emptyState);
        }
        
        function clearSearch() {
            window.location.href = "{% url 'mahsulotlar' %}";
        }
        
        function sortProducts(by, direction) {
            const categorySections = document.querySelectorAll('.category-section');
            
            categorySections.forEach(section => {
                const products = Array.from(section.querySelectorAll('.product-item'));
                
                products.sort((a, b) => {
                    let aValue, bValue;
                    
                    if (by === 'name') {
                        aValue = a.querySelector('h4').textContent.toLowerCase();
                        bValue = b.querySelector('h4').textContent.toLowerCase();
                    } else if (by === 'quantity') {
                        aValue = parseFloat(a.dataset.quantity) || 0;
                        bValue = parseFloat(b.dataset.quantity) || 0;
                    }
                    
                    if (direction === 'asc') {
                        return aValue > bValue ? 1 : -1;
                    } else {
                        return aValue < bValue ? 1 : -1;
                    }
                });
                
                // Tartiblangan mahsulotlarni qayta joylashtirish
                const container = section.querySelector('.category-products');
                products.forEach(product => {
                    container.appendChild(product);
                });
            });
        }
        
        function filterLowStockProducts() {
            const productItems = document.querySelectorAll('.product-item');
            const categorySections = document.querySelectorAll('.category-section');
            
            productItems.forEach(product => {
                const quantity = parseFloat(product.dataset.quantity) || 0;
                const isLowStock = product.classList.contains('low-stock');
                
                if (isLowStock || quantity <= 5) {
                    product.style.display = 'block';
                } else {
                    product.style.display = 'none';
                }
            });
            
            // Bo'sh kategoriyalarni yashirish
            categorySections.forEach(section => {
                const visibleProducts = section.querySelectorAll('.product-item[style="display: block"]');
                if (visibleProducts.length === 0) {
                    section.style.display = 'none';
                } else {
                    section.style.display = 'block';
                }
            });
        }
        
        function filterOutOfStockProducts() {
            const productItems = document.querySelectorAll('.product-item');
            const categorySections = document.querySelectorAll('.category-section');
            
            productItems.forEach(product => {
                const quantity = parseFloat(product.dataset.quantity) || 0;
                
                if (quantity <= 0) {
                    product.style.display = 'block';
                } else {
                    product.style.display = 'none';
                }
            });
            
            // Bo'sh kategoriyalarni yashirish
            categorySections.forEach(section => {
                const visibleProducts = section.querySelectorAll('.product-item[style="display: block"]');
                if (visibleProducts.length === 0) {
                    section.style.display = 'none';
                } else {
                    section.style.display = 'block';
                }
            });
        }
        
        // Mahsulot elementiga bosilganda batafsil sahifaga o'tish
        document.addEventListener('click', function(e) {
            const productItem = e.target.closest('.product-item');
            if (productItem && !e.target.closest('.edit-btn') && !e.target.closest('.delete-btn')) {
                const productId = productItem.querySelector('.delete-btn')?.dataset.productId;
                if (productId) {
                    window.location.href = `/product/${productId}/detail/`;
                }
            }
        });
    </script>
</body>
</html>